$requiredext = Get-Content .\requiredext.txt

$vms = get-azvm 
  
$output = Foreach($vm in $vms){

$extensions =  get-azvmextension -resourcegroupname $vm.resourcegroupname -vmname $vm.name

[pscustomobject]@{

VM = $vm.name
Resourcegroup = $vm.resourcegroupname
InstalledExtensions = $extensions.extensiontype
MissingExtensions = $requiredext | ? {$_ -notin $extenstions.extensiontype}
FailedExtensions = ($extensions| ?{ $_.ProvisioningState -eq 'Failed'}).extensiontype
UpdateAvailable = ''

}

}






AzureDiskEncryption
VMJITAccessExtension
BGInfo
MCustomScriptExtension
JsonADDomainExtension
VMAccessAgent
MicrosoftMonitoringAgent
DSC
